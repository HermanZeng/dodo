<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="resources/images/dodo.ico">

    <title>Dodo book management</title>

    <script src="resources/js/jquery-2.2.2.js"></script>
    <script src="resources/bootstrap/js/bootstrap.min.js"></script>
    <link href="resources/bootstrap/css/bootstrap.css" rel="stylesheet">

    <link href="resources/css/dashboard.css" rel="stylesheet">

    <script src="resources/js/books-form.js"></script>
    <script src="resources/js/books-table.js"></script>

    <link href="resources/css/bootstrap-multiselect.css" rel="stylesheet">
    <script src="resources/js/bootstrap-multiselect.js"></script>
    <link rel='stylesheet' type="text/css" href="resources/css/bootstrap-typeahead.css">
    <script src="/resources/js/typeahead.bundle.js"></script>

</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Dodo dashboard</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Settings</a></li>
                <li><a href="#">Profile</a></li>
                <li><a href="#">Help</a></li>
            </ul>
            <form class="navbar-form navbar-right">
                <input type="text" class="form-control" placeholder="Search...">
            </form>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li><a href="dashboard.html">Overview </a></li>
                <li><a href="users.html">Users </a></li>
                <li class="active"><a href="#">Books <span class="sr-only">(current)</span></a></li>
                <li><a href="#">Export</a></li>
            </ul>
            <ul class="nav nav-sidebar">
                <li><a href="">Nav item</a></li>
                <li><a href="">Nav item again</a></li>
                <li><a href="">One more nav</a></li>
                <li><a href="">Another nav item</a></li>
                <li><a href="">More navigation</a></li>
            </ul>
            <ul class="nav nav-sidebar">
                <li><a href="">Nav item again</a></li>
                <li><a href="">One more nav</a></li>
                <li><a href="">Another nav item</a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Manage books</h1>

            <div>
                <button class="btn btn-danger" onclick="prepareCreate()"
                        data-toggle="modal"
                        data-target="#dodo-modal">Create Book
                </button>
            </div>
            <p></p>
            <p></p>

            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Publisher</th>
                    <th>Category</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>

                <tr style="height: 53px;">
                    <td class="dodo-datagrid-td" id="0-bookId"></td>
                    <td class="dodo-datagrid-td" id="0-title"></td>
                    <td class="dodo-datagrid-td" id="0-authors"></td>
                    <td class="dodo-datagrid-td" id="0-publisher"></td>
                    <td class="dodo-datagrid-td" id="0-category"></td>
                    <td class="dodo-datagrid-td" id="0-action"></td>
                </tr>
                <tr style="height: 53px;">
                    <td class="dodo-datagrid-td" id="1-bookId"></td>
                    <td class="dodo-datagrid-td" id="1-title"></td>
                    <td class="dodo-datagrid-td" id="1-authors"></td>
                    <td class="dodo-datagrid-td" id="1-publisher"></td>
                    <td class="dodo-datagrid-td" id="1-category"></td>
                    <td class="dodo-datagrid-td" id="1-action"></td>
                </tr>
                <tr style="height: 53px;">
                    <td class="dodo-datagrid-td" id="2-bookId"></td>
                    <td class="dodo-datagrid-td" id="2-title"></td>
                    <td class="dodo-datagrid-td" id="2-authors"></td>
                    <td class="dodo-datagrid-td" id="2-publisher"></td>
                    <td class="dodo-datagrid-td" id="2-category"></td>
                    <td class="dodo-datagrid-td" id="2-action"></td>
                </tr>
                <tr style="height: 53px;">
                    <td class="dodo-datagrid-td" id="3-bookId"></td>
                    <td class="dodo-datagrid-td" id="3-title"></td>
                    <td class="dodo-datagrid-td" id="3-authors"></td>
                    <td class="dodo-datagrid-td" id="3-publisher"></td>
                    <td class="dodo-datagrid-td" id="3-category"></td>
                    <td class="dodo-datagrid-td" id="3-action"></td>
                </tr>
                <tr style="height: 53px;">
                    <td class="dodo-datagrid-td" id="4-bookId"></td>
                    <td class="dodo-datagrid-td" id="4-title"></td>
                    <td class="dodo-datagrid-td" id="4-authors"></td>
                    <td class="dodo-datagrid-td" id="4-publisher"></td>
                    <td class="dodo-datagrid-td" id="4-category"></td>
                    <td class="dodo-datagrid-td" id="4-action"></td>

                    </td>
                </tr>

                </tbody>
            </table>
            <ul class="pager">
                <li id="page-older" class="previous disabled"><a onclick="">&larr; Older</a></li>
                <li id="page-next" class="next"><a onclick="pageUp()">Newer &rarr;</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="modal fade" id="dodo-modal" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="dodo-modal-title">
                    Edit Book
                </h4>
            </div>
            <div class="modal-body">
                <form id="dodo-modal-form" class="form-horizontal">
                    <fieldset>
                        <div class="panel-group" id="accordion">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseOne">
                                            第 1 部分 图书概要
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseOne" class="panel-collapse collapse in">
                                    <div class="panel-body">
                                        <div id="form-id-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">ID</label>
                                            <div class="controls">
                                                <input id="form-bookId" name="book.id" type="text" placeholder=""
                                                       class="form-control" disabled>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Work ID</label>
                                            <div class="controls">
                                                <input id="form-wid" name="book.wid" type="text" placeholder=""
                                                       class="form-control dodo-form-item">
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Title</label>
                                            <div class="controls">
                                                <input id="form-title" name="book.title" type="text"
                                                       placeholder="book title..."
                                                       class="form-control dodo-form-item">
                                                <span id="form-title-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Introduction</label>
                                            <div class="controls">
                                                <input id="form-intro" name="book.introduction" type="text"
                                                       placeholder="introduction..."
                                                       class="form-control dodo-form-item">
                                                <span id="form-intro-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div id="form-pb-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Publisher</label>
                                            <div class="controls">
                                                <input id="form-publisher" name="book.publisher" type="text"
                                                       placeholder="book publisher..."
                                                       class="form-control dodo-form-item">
                                                <span id="form-publisher-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseTwo">
                                            第 2 部分 图书详情
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseTwo" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Page</label>
                                            <div class="controls">
                                                <input id="form-page" name="book.pages" type="number"
                                                       placeholder="total page..."
                                                       class="form-control dodo-form-item">
                                                <span id="form-page-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">ISBN-10</label>
                                            <div class="controls">
                                                <input id="form-isbn10" name="book.isbn10" type="number" placeholder=""
                                                       class="form-control dodo-form-item">
                                                <span id="form-isbn10-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div class="control-group">
                                            <label class="control-label" for="dodo-modal-form">ISBN-13</label>
                                            <div class="controls">
                                                <input id="form-isbn13" name="book.isn13" type="number" placeholder=""
                                                       class="form-control dodo-form-item">
                                                <span id="form-isbn13-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a data-toggle="collapse" data-parent="#accordion"
                                           href="#collapseThree">
                                            第 3 部分 其他
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseThree" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <div id="form-img-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Image</label>
                                            <div class="controls">
                                                <input id="form-image" name="book.image" type="text"
                                                       placeholder="image url path..."
                                                       class="form-control dodo-form-item">
                                                <span id="form-image-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div id="form-rt-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Rate</label>
                                            <div class="controls">
                                                <input id="form-rate" name="book.rate" type="number" placeholder=""
                                                       class="form-control dodo-form-item">
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div id="form-ctg-block" class="control-group">
                                            <label class="control-label">Category</label>

                                            <div class="controls">
                                                <select id="form-category" multiple="multiple">
                                                    <option value="0">文学</option>
                                                    <option value="1">历史</option>
                                                    <option value="2">科技</option>
                                                    <option value="3">工具书</option>
                                                </select>
                                                <br/>
                                                <span id="form-category-tip"
                                                      class="form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div id="form-authors-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Authors</label>
                                            <div class="controls">
                                <span id="authors-plus" class="btn btn-default" style="padding: 9px 12px;"
                                      onclick="openSearchModal(0)"
                                      data-toggle="modal"
                                      data-target="#dodo-search-modal"><a><span
                                        class="glyphicon glyphicon-plus"></span></a></span>
                                                <span id="form-authors-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>

                                        <div id="form-translators-block" class="control-group">
                                            <label class="control-label" for="dodo-modal-form">Translators</label>
                                            <div class="controls">
                                <span id="translators-plus" class="btn btn-default" style="padding: 9px 12px;"
                                      onclick="openSearchModal(1)"
                                      data-toggle="modal"
                                      data-target="#dodo-search-modal"><a><span
                                        class="glyphicon glyphicon-plus"></span></a></span>
                                                <span id="form-translators-tip" class="dodo-form-item-tip"
                                                      style="display:none;color:red;"></span>
                                                <p class="help-block"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="control-group">

                            <div style="width: 100%;height:20px; text-align: center">
                                <div class="alert alert-warning alert-dismissable dodo-msg-box"
                                     style="display:none;">
                                    <strong></strong>
                                </div>
                            </div>
                        </div>

                        <!-- Button -->
                        <div class="modal-footer">
                            <button id="dodo-form-savebtn" type="button" onclick="commitForm()"
                                    class="btn btn-primary">Save
                            </button>
                            <button type="button" data-dismiss="modal" class="btn btn-default">Close</button>
                        </div>
                    </fieldset>
                </form>

            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dodo-delete-modal" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">
                    Delete Book
                </h4>
            </div>
            <div class="modal-body">
                <div class="alert alert-dismissable alert-danger">
                    <h4>
                        <strong>Warning!</strong> You are going to delete the book:
                    </h4>
                    <ul>
                        <li><strong>id = </strong><strong id="deleteId"></strong></li>
                    </ul>
                    <p></p>
                </div>
                <h4>
                    Do you confirm?
                </h4>
                <div style="width: 100%;height:20px; text-align: center">
                    <div class="alert alert-warning alert-dismissable dodo-msg-box"
                         style="display:none;">
                        <strong></strong>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="commitDelete()" class="btn btn-danger">Delete
                </button>
                <button type="button" data-dismiss="modal" class="btn btn-default">Close</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="dodo-search-modal" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div style="width: 100%;">
                    <input id="search" class="typeahead" type="text" placeholder="type to search...">
                    <script>
                        var authorsResource = new Bloodhound({
                            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
                            queryTokenizer: Bloodhound.tokenizers.whitespace,
                            remote: {
                                url: 'searchAuthorAction.action?q=%QUERY',
                                wildcard: '%QUERY'
                            }
                        });

                        var translatorsResource = new Bloodhound({
                            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
                            queryTokenizer: Bloodhound.tokenizers.whitespace,
                            remote: {
                                url: 'searchTranslatorAction.action?q=%QUERY',
                                wildcard: '%QUERY'
                            }
                        });

                        $('#search').typeahead({
                                    hint: true,
                                    highlight: true,
                                    minLength: 1
                                }, {
                                    name: 'authors-resources',
                                    display: 'name',
                                    source: authorsResource,
                                    templates: {
                                        header: '<h3 style="margin: 0 20px 5px 20px;padding: 3px 0;border-bottom: 1px solid #ccc;font-weight:bold;">作家</h3>'
                                    }
                                },
                                {
                                    name: 'translators-resources',
                                    display: 'name',
                                    source: translatorsResource,
                                    templates: {
                                        header: '<h3 style="margin: 0 20px 5px 20px;padding: 3px 0;border-bottom: 1px solid #ccc;font-weight:bold;">译者</h3>'
                                    }
                                }).bind('typeahead:select', function (ev, suggestion) {

                            if (modifyingAuthors) {
                                $("#form-authors-tip").css({"display": "none"});
                                if (!(suggestion.id in canAuthors)) {
                                    canAuthors[suggestion.id] = suggestion;

                                    $("#authors-plus").before('<span class="btn btn-default dodo-removable-label" id=acan'
                                            + suggestion.id
                                            + '>'
                                            + suggestion.name
                                            + '<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><a onclick="removeACandidate(\''
                                            + suggestion.id
                                            + '\')"><span class="glyphicon glyphicon-remove"></span></a></span>');
                                }

                            }
                            else {
                                $("#form-translators-tip").css({"display": "none"});
                                if (!(suggestion.id in canTranslators)) {
                                    canTranslators[suggestion.id] = suggestion;

                                    $("#translators-plus").before('<span class="btn btn-default dodo-removable-label" id=tcan'
                                            + suggestion.id
                                            + '>'
                                            + suggestion.name
                                            + '<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><a onclick="removeTCandidate(\''
                                            + suggestion.id
                                            + '\')"><span class="glyphicon glyphicon-remove"></span></a></span>');
                                }
                            }


                            $("#dodo-modal").modal('show');
                            $("#search").text('');
                            $("#dodo-search-modal").modal('hide');
                        });

                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
